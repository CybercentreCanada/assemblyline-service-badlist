name: Badlist
version: $SERVICE_TAG
description: >
  ALv4 Badlist service

  This service will check the file hashes against Assemblyline's internal badlist infrastructure and mark
  files as bad accordingly.

accepts: .*
rejects: empty|metadata/.*

stage: REVIEW
category: Static Analysis

uses_tags: true
file_required: false
timeout: 10
disable_cache: false
privileged: true

enabled: true

heuristics:
  - heur_id: 1
    name: Badlisted File
    score: 1000
    filetype: "*"
    description: This file is found in the list of know bad files
    max_score: 1000
  - heur_id: 2
    name: Badlisted IOC
    score: 1000
    filetype: "*"
    description: This Indicator Of Compromise is found in the list of know bad IOCs
    max_score: 1000
  - heur_id: 3
    name: Badlisted Similar File
    score: 500
    filetype: "*"
    description: This file is similar to a file found in the list of know bad files

config:
  cache_timeout_seconds: 1800
  lookup_md5: false
  lookup_sha1: false
  lookup_sha256: true
  lookup_ssdeep: false
  lookup_tlsh: true
  lookup_ip: false
  lookup_domain: false
  lookup_url: false

docker_config:
  image: ${REGISTRY}cccs/assemblyline-service-badlist:$SERVICE_TAG
  cpu_cores: 0.4
  ram_mb: 256

dependencies:
  updates:
    container:
      allow_internet_access: true
      command: ["python", "-m", "badlist.update_server"]
      image: ${REGISTRY}cccs/assemblyline-service-badlist:$SERVICE_TAG
      ports: ["5003"]
      cpu_cores: 2
      ram_mb: 4096
    run_as_core: True

update_config:
  generates_signatures: false
  sources:
    - name: malpedia
      uri: https://malpedia.caad.fkie.fraunhofer.de/api/list/families?format=json
      pattern: .*\/families
      configuration:
        type: malware_family_list
        format: list
    - name: malpedia_attribution
      uri: https://malpedia.caad.fkie.fraunhofer.de/api/list/actors?format=json
      pattern: .*\/actors
      configuration:
        type: attribution_list
        format: list
    - name: phishunt
      uri: https://phishunt.io/feed.txt
      pattern: .*\/feed\.txt
      configuration:
        type: blocklist
        format: csv
        uri: 0
    - name: urlhaus
      uri: https://urlhaus.abuse.ch/downloads/csv
      pattern: .*\/csv\.txt$
      configuration:
        type: blocklist
        format: csv
        uri: 2
        malware_family: 6
        reference: 7
        start: 9
      update_interval: 300 # Every 5 minutes
    - name: blackbook
      uri: https://github.com/stamparm/blackbook.git
      pattern: .*\.csv$
      configuration:
        type: blocklist
        format: csv
        domain: 0
        malware_family: 1
        start: 1
    - name: feodotracker
      uri: https://feodotracker.abuse.ch/downloads/ipblocklist.json
      pattern: .*ipblocklist\.json
      configuration:
        type: blocklist
        format: json
        ip: ip_address
        domain: hostname
        malware_family: malware
      update_interval: 300 # Every 5 minutes
    - name: threatfox
      uri: https://threatfox.abuse.ch/export/csv/recent
      pattern: .*\/recent
      configuration:
        type: blocklist
        format: csv
        dtl: 30
        start: 9
        ip: 2
        domain: 2
        uri: 2
        sha1: 2
        sha256: 2
        md5: 2
        malware_family: 5
        reference: 10
      update_interval: 300 # Every 5 minutes
    - name: "threatview.io_C2_Hunt_Feed"
      uri: https://threatview.io/Downloads/High-Confidence-CobaltStrike-C2%20-Feeds.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        start: 3
        ip: 0
        domain: 2
        reference: 5
        default_attribution:
          family: ["COBALT STRIKE"]
      update_interval: 86400 # Daily
    - name: "threatview.io_IP_Blocklist"
      uri: https://threatview.io/Downloads/IP-High-Confidence-Feed.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        ip: 0
      update_interval: 86400 # Daily
    - name: "threatview.io_Domain_Blocklist"
      uri: https://threatview.io/Downloads/DOMAIN-High-Confidence-Feed.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
      update_interval: 86400 # Daily
    - name: "threatview.io_MD5_Hash_Blocklist"
      uri: https://threatview.io/Downloads/MD5-HASH-ALL.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        md5: 0
      update_interval: 86400 # Daily
    - name: "threatview.io_URL_Blocklist"
      uri: https://threatview.io/Downloads/URL-High-Confidence-Feed.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        uri: 0
      update_interval: 86400 # Daily
    - name: "threatview.io_SHA_Hash_Blocklist"
      uri: https://threatview.io/Downloads/SHA-HASH-FEED.txt
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        sha1: 0
      update_interval: 86400 # Daily
    - name: Google
      uri: https://github.com/google/threat-team.git
      pattern: .*\.csv
      configuration:
        type: blocklist
        format: csv
        ip: 0
        domain: 0
        uri: 0
        sha256: 0
        reference: 2
      update_interval: 86400 # Daily
    - name: RedFlagDomains
      uri: https://dl.red.flag.domains/red.flag.domains.txt
      pattern: .*red\.flag\.domains\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: CiscoTalos
      uri: https://github.com/Cisco-Talos/IOCs.git
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        ip: 0
        domain: 0
        uri: 0
        sha256: 0
    - name: CERT.PL
      uri: https://hole.cert.pl/domains/v2/domains.txt
      pattern: .*domains\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: tweedge
      uri: https://hosts.tweedge.net/malicious.txt
      pattern: .*malicious\.txt
      configuration:
        type: blocklist
        format: hosts
    - name: CyberHost.uk
      uri: https://lists.cyberhost.uk/malware.txt
      pattern: .*malware\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: PhishingArmy
      uri: https://phishing.army/download/phishing_army_blocklist_extended.txt
      pattern: .*phishing_army_blocklist_extended\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: MalwareFilter
      uri: https://phishing-filter.pages.dev/phishing-filter-hosts.txt
      pattern: .*phishing-filter-hosts\.txt
      configuration:
        type: blocklist
        format: hosts
    - name: SinkingYachts
      uri: https://phish.sinking.yachts/v2/text
      pattern: .*
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: 2004gixxer600
      uri: https://raw.githubusercontent.com/2004gixxer600/BlockLists/refs/heads/main/MaliciousDomain.txt
      pattern: .*MaliciousDomain\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: AmnestyTech
      uri: https://github.com/AmnestyTech/investigations.git
      pattern: .*\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
        ip: 0
        sha256: 0
    - name: bigdargon
      uri: https://raw.githubusercontent.com/bigdargon/hostsVN/master/extensions/threat/hosts
      pattern: .*hosts$
      configuration:
        type: blocklist
        format: hosts
    # TODO: Pending https://github.com/CybercentreCanada/assemblyline-v4-service/pull/825
    # - name: ut_capitole
    #   uri: https://dsi.ut-capitole.fr/blacklists/download/malware.tar.gz
    #   pattern: .*domains$
    #   configuration:
    #     type: blocklist
    #     format: csv
    #     domain: 0
    - name: durablenapkin
      uri: https://raw.githubusercontent.com/durablenapkin/scamblocklist/master/hosts.txt
      pattern: .*hosts\.txt
      configuration:
        type: blocklist
        format: hosts
    - name: elliotwutingfeng
      uri: https://raw.githubusercontent.com/elliotwutingfeng/GlobalAntiScamOrg-blocklist/main/global-anti-scam-org-scam-urls-pihole.txt
      pattern: .*global-anti-scam-org-scam-urls-pihole\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: jarelllama
      uri: https://github.com/jarelllama/Blocklist-Sources.git
      pattern: .*(malwareurl|scamscavenger)\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: openphish
      uri: https://raw.githubusercontent.com/openphish/public_feed/refs/heads/main/feed.txt
      pattern: .*feed\.txt
      configuration:
        type: blocklist
        format: csv
        uri: 0
    - name: phishdestroy
      uri: https://raw.githubusercontent.com/phishdestroy/destroylist/refs/heads/main/list.json
      pattern: .*list.json
      configuration:
        type: blocklist
        format: json
    - name: ShadowWhisperer
      uri: https://raw.githubusercontent.com/ShadowWhisperer/BlockLists/master/Lists/Malware
      pattern: .*Malware$
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: maltrail
      uri: https://github.com/stamparm/maltrail.git
      pattern: .*\/trails\/static\/(malicious|malware)\/.+\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
        ip: 0
        uri: 0
    - name: kushari
      uri: https://www.kushari.org/downloads/mal.txt
      pattern: .*mal\.txt
      configuration:
        type: blocklist
        format: hosts
    - name: stopforumspam
      uri: https://www.stopforumspam.com/downloads/toxic_domains_whole.txt
      pattern: .*toxic_domains_whole\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
    - name: usom.gov.tr
      uri: https://www.usom.gov.tr/url-list.txt
      pattern: .*url-list\.txt
      configuration:
        type: blocklist
        format: csv
        domain: 0
        ip: 0

  update_interval_seconds: 900 # Every 15 minutes
  wait_for_update: false

